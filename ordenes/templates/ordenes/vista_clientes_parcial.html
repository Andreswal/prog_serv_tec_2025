<h3>ğŸ‘¤ Lista de Clientes</h3>

<form class="form-inline mb-3">
Â  Â  Â  <input type="text" name="q" value="{% if q %}{{ q }}{% endif %}" id="busquedaClienteInput" class="form-control mr-2" placeholder="Buscar por nombre o telÃ©fono">
Â  Â  Â  <button type="button" id="btnBuscarCliente" class="btn btn-primary">Buscar</button>Â 
    </form>

<div class="mb-3">
  <button class="btn btn-success" onclick="abrirVentana('nuevo-cliente', '/clientes/nuevo/')">
    â• Nuevo Cliente
  </button>
</div>


<table id="tabla-clientes" class="table table-bordered table-hover table-sm">
Â  Â  <thead class="thead-dark">
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th>Nombre</th>
Â  Â  Â  Â  Â  Â  <th>TelÃ©fono</th>
Â  Â  Â  Â  Â  Â  <th>Email</th>
Â  Â  Â  Â  Â  Â  <th>DirecciÃ³n</th>
Â  Â  Â  Â  </tr>
Â  Â  </thead>
Â  Â  <tbody>
Â  Â  Â  Â  {% for cliente in clientes %}
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td>{{ cliente.nombre }}</td>
Â  Â  Â  Â  Â  Â  <td>{{ cliente.telefono }}</td>
Â  Â  Â  Â  Â  Â  <td>{{ cliente.email }}</td>
Â  Â  Â  Â  Â  Â  <td>{{ cliente.direccion }}</td>
Â  Â  Â  Â  </tr>
Â  Â  Â  Â  {% empty %}
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td colspan="4" class="text-center text-muted">No hay clientes registrados.</td>
Â  Â  Â  Â  </tr>
Â  Â  Â  Â  {% endfor %}
Â  Â  </tbody>
</table>

<script>
    // âš ï¸ ATENCIÃ“N: Si tu URL en urls.py usa un prefijo como 'ordenes/', 
    // debes usar '/ordenes/clientes/parcial/' en lugar de '/clientes/parcial/'.

    // 1. FILTRO DE SERVIDOR (BotÃ³n Buscar)
    $('#btnBuscarCliente').on('click', function(e) { 
        e.preventDefault(); 
        
        const query = $('#busquedaClienteInput').val(); 
        
        // ğŸš€ Ajustar esta URL si es necesario
        // OpciÃ³n A: URL absoluta a la raÃ­z
        const nuevaUrl = '/clientes/parcial/?q=' + encodeURIComponent(query); 
        
        // OpciÃ³n B: Si tu aplicaciÃ³n se llama 'ordenes' y tiene ese prefijo:
        // const nuevaUrl = '/ordenes/clientes/parcial/?q=' + encodeURIComponent(query); 

        // Recarga el contenido de la ventana flotante
        $('#contenido-ventana-clientes').load(nuevaUrl, function(response, status, xhr) {
            if (status == "error") {
                console.error("Error al recargar la bÃºsqueda AJAX:", xhr.status, xhr.statusText, nuevaUrl); 
            }
        });
    });

    // 2. FILTRO LOCAL EN TIEMPO REAL
    $('#busquedaClienteInput').on('input', function() {
        const filtro = $(this).val().toLowerCase();
        
        $('#tabla-clientes tbody tr').each(function() {
            const texto = $(this).text().toLowerCase();
            $(this).toggle(texto.includes(filtro));
        });
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  window.addEventListener('message', function(e) {
    if (e.data && e.data.accion === 'cliente_creado') {
      // Recargar la lista de clientes dentro de la ventana actual
      fetch('/clientes/parcial/')
        .then(res => res.text())
        .then(html => {
          const cont = document.querySelector('#tabla-clientes').parentElement;
          cont.innerHTML = html;
          // volver a inicializar buscador
          if (window.clientesInit) window.clientesInit(cont);
        });
    }
  });
});
</script>


